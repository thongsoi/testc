<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Form</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/htmx.org/dist/ext/json-enc.js"></script>
</head>
<body>
    <h1>Order Form</h1>
    <form hx-post="/submit-order" hx-target="#order-response">
        <div>
            <label for="market">Select Market:</label>
            <select id="market" name="market_id" hx-get="/get-products" hx-target="#product" hx-trigger="change">
                <option value="">Choose a market</option>
            </select>
        </div>
        <div>
            <label for="product">Select Product:</label>
            <select id="product" name="product_id" disabled>
                <option value="">Choose a product</option>
            </select>
        </div>
        <div>
            <label for="quantity">Quantity:</label>
            <input type="number" id="quantity" name="quantity" min="1" value="1">
        </div>
        <button type="submit">Submit Order</button>
    </form>
    <div id="order-response"></div>

    <script>
    document.body.addEventListener('htmx:afterSwap', function(event) {
        if (event.detail.target.id === 'product') {
            document.getElementById('product').disabled = false;
        }
    });

    // Load markets when the page loads
    htmx.ajax('GET', '/get-markets', '#market')
    </script>
</body>
</html>